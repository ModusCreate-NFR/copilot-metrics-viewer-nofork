---
applyTo: '**'
---

# Linting Instructions for Copilot Metrics Viewer

## Overview

This project uses ESLint with Nuxt's flat config format to enforce code quality and consistency across TypeScript, Vue, and JavaScript files. The linting setup is integrated with @nuxt/eslint module and follows modern ESLint best practices.

## Linting Configuration

### File Types and Scope

Linting applies to the following file types:
- **TypeScript**: `*.ts`, `*.tsx` - All TypeScript source files
- **Vue**: `*.vue` - All Vue Single File Components (SFCs)
- **JavaScript**: `*.js`, `*.mjs` - Configuration and utility files
- **Configuration**: `eslint.config.mjs`, `nuxt.config.ts`, `vitest.config.ts`, etc.

### ESLint Configuration Location

- **Main config**: `/eslint.config.mjs` (uses Nuxt's flat config format)
- **Generated config**: `/.nuxt/eslint.config.mjs` (auto-generated by @nuxt/eslint module)
- **Package scripts**: 
  - `npm run lint` - Run linting checks
  - `npm run lint:fix` - Auto-fix linting issues where possible

## Linting Rules

### TypeScript Rules (@typescript-eslint)

The project uses `@typescript-eslint/recommended` configuration with the following key rules:

#### Current Known Issues (60 errors as of baseline)

1. **@typescript-eslint/no-explicit-any** (Most common - ~35 violations)
   - **Current state**: Multiple files use `any` type
   - **Files affected**: 
     - `app/components/ApiResponse.vue`
     - `app/components/BreakdownComponent.vue`
     - `app/components/CopilotChatViewer.vue`
     - `app/components/MainComponent.vue`
     - `app/components/MetricsViewer.vue`
     - `app/model/Breakdown.ts`
     - `app/model/Metrics.ts`
     - `app/model/Seat.ts`
     - `server/api/github-stats.ts`
     - `tests/github-middleware.nuxt.spec.ts`
     - `tests/metrics-cache.nuxt.spec.ts`
   - **When fixing**: Replace `any` with specific types:
     ```typescript
     // ‚úó BAD
     const data: any = response
     
     // ‚úì GOOD
     const data: MetricsResponse = response
     // or if truly unknown:
     const data: unknown = response
     if (isMetricsResponse(data)) { /* use data */ }
     ```

2. **@typescript-eslint/no-unused-vars** (~23 violations)
   - **Current state**: Some imported variables are unused
   - **Files affected**:
     - `app/components/BreakdownComponent.vue` - `toRef` imported but unused
     - `e2e-tests/copilot.ent.spec.ts` - `expect` imported but unused
     - `e2e-tests/copilot.org.spec.ts` - `expect` imported but unused
     - `e2e-tests/copilot.team.spec.ts` - `expect` imported but unused
     - `e2e-tests/github-tab.spec.ts` - `GitHubTab` imported but unused
     - `e2e-tests/metrics.spec.ts` - Multiple unused imports
     - `e2e-tests/pages/ApiResponseTab.ts` - `expect`, `Locator` unused
     - `server/routes/auth/github.get.ts` - `FetchError` unused
     - `tests/MetricsViewer.nuxt.spec.ts` - Multiple unused imports
   - **When fixing**: 
     - Remove unused imports
     - Or prefix with underscore if needed for type checking: `_toRef`
     ```typescript
     // ‚úó BAD
     import { toRef, computed } from 'vue'
     // only using computed
     
     // ‚úì GOOD - remove unused
     import { computed } from 'vue'
     
     // ‚úì GOOD - prefix if needed for future
     import { toRef as _toRef, computed } from 'vue'
     ```

### Vue Rules (eslint-plugin-vue)

The project follows Vue 3 best practices with the following considerations:

1. **vue/no-reserved-component-names** (2 violations)
   - **Current state**: `Line` component name conflicts with reserved names
   - **Files affected**:
     - `app/components/CopilotChatViewer.vue`
     - `app/components/MetricsViewer.vue`
   - **When fixing**: Rename to more specific names:
     ```vue
     <!-- ‚úó BAD -->
     <script setup>
     import { Line } from 'vue-chartjs'
     </script>
     
     <!-- ‚úì GOOD -->
     <script setup>
     import { Line as LineChart } from 'vue-chartjs'
     </script>
     ```

### File-Specific Rules

#### Vue Single File Components (.vue)

Apply these rules to all `.vue` files:

```javascript
{
  'vue/multi-word-component-names': 'error',
  'vue/no-reserved-component-names': 'error',
  'vue/component-name-in-template-casing': ['error', 'PascalCase'],
  'vue/html-indent': ['error', 2],
  'vue/max-attributes-per-line': ['error', {
    'singleline': { 'max': 3 },
    'multiline': { 'max': 1 }
  }]
}
```

#### TypeScript Files (.ts)

Apply these rules to all `.ts` files:

```javascript
{
  '@typescript-eslint/no-explicit-any': 'error',
  '@typescript-eslint/no-unused-vars': ['warn', { 
    'argsIgnorePattern': '^_',
    'varsIgnorePattern': '^_'
  }],
  '@typescript-eslint/explicit-function-return-type': 'off',
  '@typescript-eslint/explicit-module-boundary-types': 'off'
}
```

#### Test Files (*.spec.ts, *.test.ts)

Special considerations for test files:

```javascript
{
  '@typescript-eslint/no-explicit-any': 'warn', // Relaxed for test data
  'vue/no-reserved-component-names': 'off', // Allow in tests
}
```

## Best Practices

### When Writing New Code

1. **Always specify types explicitly**
   ```typescript
   // ‚úó BAD
   function processMetrics(data: any) { }
   
   // ‚úì GOOD
   function processMetrics(data: MetricsResponse): ProcessedMetrics { }
   ```

2. **Use Vue 3 composition API conventions**
   ```vue
   <!-- ‚úì GOOD -->
   <script setup lang="ts">
   import { ref, computed, type Ref } from 'vue'
   
   const count: Ref<number> = ref(0)
   const doubled = computed(() => count.value * 2)
   </script>
   ```

3. **Component naming**
   - Use multi-word component names: `MetricsViewer`, `SeatsAnalysis`
   - Use PascalCase for component names
   - Avoid reserved names: `Line`, `Table`, `Form`, etc.

4. **Import organization**
   ```typescript
   // 1. External dependencies
   import { ref, computed } from 'vue'
   import { Chart } from 'chart.js'
   
   // 2. Internal modules
   import { processMetrics } from '~/utils/metrics'
   import type { MetricsData } from '~/model/Metrics'
   
   // 3. Local imports
   import BreakdownComponent from './BreakdownComponent.vue'
   ```

### When Fixing Existing Code

1. **Don't introduce new linting errors**
   - Always run `npm run lint` before committing
   - Fix any new errors you introduce
   - Existing errors (60 baseline) can remain unless you're modifying that file

2. **When modifying files with existing errors**
   - Fix linting errors in code sections you're changing
   - You may leave unrelated errors in the same file
   - Document if fixing all errors would require extensive refactoring

3. **Incremental improvement**
   - When touching a file, try to fix at least one existing error
   - Prioritize high-impact fixes (security, bugs) over style issues

## Running Linting

### Local Development

```bash
# Check for linting errors
npm run lint

# Auto-fix fixable errors
npm run lint:fix

# Type checking (separate from linting)
npm run typecheck
```

### Expected Behavior

- **Current baseline**: 60 ESLint errors (known and acceptable)
- **Zero tolerance for new errors**: New code must not introduce additional errors
- **Auto-fix safe**: `lint:fix` will handle formatting and simple fixes
- **Manual fixes needed**: Type-related errors require manual intervention

### CI/CD Integration

The linting check runs as part of:
- Local development workflow
- Pre-commit hooks (if configured)
- CI pipeline validation
- Pull request checks

**Note**: Current CI may show 60 errors - this is the baseline. PRs should not increase this number.

## Ignoring Rules (Use Sparingly)

### When to Ignore

Only ignore linting rules when:
1. Dealing with third-party library types that require `any`
2. Complex type inference issues that would require major refactoring
3. Generated code or configuration files
4. Temporary technical debt with a plan to fix

### How to Ignore

```typescript
// For a single line
// eslint-disable-next-line @typescript-eslint/no-explicit-any
const data: any = externalLib.getData()

// For a block
/* eslint-disable @typescript-eslint/no-explicit-any */
function legacyCode(data: any) {
  // temporary workaround for v2.0 migration
}
/* eslint-enable @typescript-eslint/no-explicit-any */

// For entire file (rarely needed)
/* eslint-disable @typescript-eslint/no-explicit-any */
```

**Always add a comment explaining why the rule is disabled.**

## Configuration Details

### Nuxt ESLint Module

The project uses `@nuxt/eslint` module which:
- Auto-generates `.nuxt/eslint.config.mjs` on server start
- Integrates with Nuxt's build system
- Provides project-aware linting
- Supports flat config format (ESLint 9+)

### Extending Configuration

To customize rules, edit `/eslint.config.mjs`:

```javascript
// @ts-check
import withNuxt from './.nuxt/eslint.config.mjs'

export default withNuxt(
  // Add custom flat configs here
)
  .override('nuxt/typescript/rules', {
    rules: {
      // Override specific rules
      '@typescript-eslint/no-explicit-any': 'warn', // Downgrade to warning
    }
  })
```

### VSCode Integration

For the best development experience, install:
- ESLint extension for VSCode
- Configure VSCode to use flat config:

```json
{
  "eslint.useFlatConfig": true,
  "eslint.validate": [
    "javascript",
    "typescript",
    "vue"
  ],
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  }
}
```

## Troubleshooting

### Common Issues

1. **"Parser error" or "Cannot find module"**
   - Run `npm install` to ensure all dependencies are installed
   - Ensure `.nuxt` directory exists (run `npm run dev` once)

2. **ESLint not finding config**
   - Check that `eslint.config.mjs` exists in project root
   - Verify `@nuxt/eslint` is in `nuxt.config.ts` modules array

3. **Rules not applying to Vue files**
   - Ensure `vue-eslint-parser` is installed
   - Check file glob patterns in config

4. **Too many errors**
   - Focus on errors in files you're modifying
   - Use `lint:fix` for auto-fixable issues
   - Consider using `--max-warnings` flag in CI for gradual improvement

### Getting Help

- Review ESLint errors in the Problems panel (VSCode)
- Check rule documentation: https://typescript-eslint.io/rules/
- Vue rules: https://eslint.vuejs.org/rules/
- Nuxt ESLint: https://eslint.nuxt.com/

## Summary

**Key Points for AI Code Generation:**

1. ‚úÖ Use explicit TypeScript types - avoid `any`
2. ‚úÖ Follow Vue 3 composition API patterns
3. ‚úÖ Use multi-word component names in PascalCase
4. ‚úÖ Remove unused imports and variables
5. ‚úÖ Run `npm run lint` before completing tasks
6. ‚ö†Ô∏è Existing 43 errors are acceptable (baseline)
7. ‚ö†Ô∏è New code must not introduce additional errors
8. üìù Document any necessary rule violations with comments

This linting configuration ensures code quality while allowing pragmatic trade-offs for this production application.